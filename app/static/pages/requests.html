<div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6 animate-up">
    <div>
        <h2 class="text-2xl font-bold text-white tracking-tight" data-i18n="requests">Vehicle Requests</h2>
        <p class="text-slate-400 text-sm mt-1" data-i18n="req_desc">Track and validate mission orders.</p>
    </div>
    <button onclick="openAddRequestModal()" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2.5 rounded-xl text-sm font-medium shadow-lg flex items-center gap-2 transition">
        <i data-lucide="plus-circle" class="w-4 h-4"></i>
        <span data-i18n="new_request">New Request</span>
    </button>
</div>

<!-- SEARCH & FILTERS -->
<div class="glass-panel p-4 mb-6 flex flex-col md:flex-row gap-4 items-center justify-between animate-up delay-1">
    <div class="relative w-full md:w-96">
        <i data-lucide="search" class="absolute left-3 top-2.5 w-4 h-4 text-slate-500"></i>
        <input type="text" id="requestSearch" data-i18n-placeholder="search_placeholder" class="input-field pl-10">
    </div>
    <select id="requestStatusFilter" class="bg-slate-900 border border-slate-700 text-slate-300 text-sm rounded-lg px-3 py-2 outline-none focus:border-blue-500">
        <option value="all" data-i18n="all">All Status</option>
        <option value="pending" data-i18n="pending">Pending</option>
        <option value="approved_by_chef">Chef Approved</option>
        <option value="approved_by_charoi">Assigned (Charoi)</option>
        <option value="fully_approved" data-i18n="fully_approved">Fully Approved</option>
        <option value="denied" data-i18n="denied">Denied</option>
    </select>
</div>

<!-- DESKTOP TABLE -->
<div class="glass-panel overflow-hidden animate-up delay-2">
    <div class="overflow-x-auto">
        <table class="w-full text-left border-collapse">
            <thead>
                <tr class="text-[10px] text-slate-500 uppercase tracking-widest border-b border-slate-700/50 bg-slate-800/40">
                    <th class="p-4" data-i18n="requester">Requester</th>
                    <th class="p-4" data-i18n="destination">Destination</th>
                    <th class="p-4" data-i18n="departure">Departure</th>
                    <th class="p-4" data-i18n="status">Status</th>
                    <th class="p-4">Assigned Resource</th>
                    <th class="p-4 text-right" data-i18n="actions">Actions</th>
                </tr>
            </thead>
            <tbody id="requestsBody" class="divide-y divide-slate-700/30">
                <!-- Data injected by JS -->
            </tbody>
        </table>
    </div>
</div>

<!-- ================= MODALS ================= -->

<!-- ADD REQUEST -->
<div id="addRequestModal" class="fixed inset-0 z-50 hidden bg-black/80 backdrop-blur-md flex items-center justify-center p-4">
    <div class="bg-slate-900 border border-slate-700 w-full max-w-lg rounded-2xl animate-up">
        <div class="p-5 border-b border-slate-700 flex justify-between items-center">
            <h3 class="text-white font-bold" data-i18n="new_request">New Vehicle Request</h3>
            <button onclick="closeModal('addRequestModal')" class="text-slate-400"><i data-lucide="x" class="w-5 h-5"></i></button>
        </div>
        <div class="p-6 space-y-4">
            <div><label class="label-text" data-i18n="destination">Destination</label><input type="text" id="reqDest" class="input-field" placeholder="City, Office..."></div>
            <div class="grid grid-cols-2 gap-4">
                <div><label class="label-text" data-i18n="departure">Start Time</label><input type="datetime-local" id="reqStart" class="input-field"></div>
                <div><label class="label-text" data-i18n="return">End Time</label><input type="datetime-local" id="reqEnd" class="input-field"></div>
            </div>
            <div>
                <label class="label-text">Passengers (Matricules, comma separated)</label>
                <textarea id="reqPassengersList" class="input-field h-20 text-xs" placeholder="MAT001, MAT002..."></textarea>
            </div>
            <div><label class="label-text">Mission Description</label><textarea id="reqDesc" class="input-field h-24"></textarea></div>
        </div>
        <div class="p-4 border-t border-slate-700 flex justify-end gap-3">
            <button onclick="closeModal('addRequestModal')" class="btn-secondary" data-i18n="cancel">Cancel</button>
            <button onclick="saveNewRequest()" class="btn-primary" data-i18n="save">Submit Request</button>
        </div>
    </div>
</div>

<!-- ASSIGN RESOURCES (CHAROI/LOGISTIC) -->
<div id="assignResourceModal" class="fixed inset-0 z-50 hidden bg-black/80 backdrop-blur-md flex items-center justify-center p-4">
    <div class="bg-slate-900 border border-slate-700 w-full max-w-md rounded-2xl animate-up">
        <div class="p-5 border-b border-slate-700 flex justify-between items-center bg-blue-600/10">
            <h3 class="text-white font-bold" data-i18n="assign_resources">Assign Vehicle & Driver</h3>
            <button onclick="closeModal('assignResourceModal')" class="text-slate-400"><i data-lucide="x" class="w-5 h-5"></i></button>
        </div>
        <div class="p-6 space-y-4">
            <div><label class="label-text">Select Available Vehicles</label><select id="assignVehicle" class="input-field"></select></div>
            <div><label class="label-text">Select Driver</label><select id="assignDriver" class="input-field"></select></div>
            <div><label class="label-text">Update Passengers (Matricules)</label><textarea id="assignPassengers" class="input-field h-16 text-xs"></textarea></div>
        </div>
        <div class="p-4 border-t border-slate-700 flex justify-end gap-3">
            <button onclick="closeModal('assignResourceModal')" class="btn-secondary">Close</button>
            <button onclick="submitAssignment()" class="btn-primary bg-blue-600">Save Assignment</button>
        </div>
    </div>
</div>

<!-- APPROVAL MODAL -->
<div id="approvalModal" class="fixed inset-0 z-50 hidden bg-black/90 backdrop-blur-md flex items-center justify-center p-4">
    <div class="bg-slate-900 border border-slate-700 w-full max-w-sm rounded-2xl animate-up">
        <div class="p-6 text-center">
            <div class="w-16 h-16 bg-blue-500/10 rounded-full flex items-center justify-center mx-auto mb-4 text-blue-500">
                <i data-lucide="user-check" class="w-8 h-8"></i>
            </div>
            <h3 class="text-white font-bold text-lg mb-1" id="approvalStageTitle">Process Approval</h3>
            <p class="text-slate-500 text-xs mb-4">Review and provide a decision.</p>
            
            <textarea id="approvalComments" class="input-field h-24 mb-4 text-sm" placeholder="Write comments or reason for denial..."></textarea>
            
            <div class="flex gap-3">
                <button onclick="submitDecision('denied')" class="btn-danger w-full py-3" data-i18n="btn_deny">Deny</button>
                <button onclick="submitDecision('approved')" class="btn-primary w-full py-3 bg-emerald-600" data-i18n="btn_approve">Approve</button>
            </div>
            <button onclick="closeModal('approvalModal')" class="mt-4 text-slate-500 text-sm hover:text-white" data-i18n="cancel">Cancel</button>
        </div>
    </div>
</div>

<style>
    .label-text { display: block; font-size: 0.65rem; font-weight: 700; text-transform: uppercase; color: #64748b; margin-bottom: 0.3rem; letter-spacing: 0.05em; }
    .input-field { width: 100%; background: #0f172a; border: 1px solid #334155; color: #f1f5f9; border-radius: 0.75rem; padding: 0.6rem 0.8rem; font-size: 0.875rem; transition: all 0.2s; outline: none; }
    .input-field:focus { border-color: #3b82f6; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1); }
    .btn-primary { background: #2563eb; color: white; border-radius: 0.75rem; font-weight: 600; font-size: 0.875rem; transition: all 0.2s; }
    .btn-secondary { background: #1e293b; border: 1px solid #334155; color: #94a3b8; border-radius: 0.75rem; padding: 0.6rem 1.2rem; font-weight: 600; font-size: 0.875rem; }
    .btn-danger { background: #b91c1c; color: white; border-radius: 0.75rem; font-weight: 600; font-size: 0.875rem; transition: all 0.2s; }
</style>